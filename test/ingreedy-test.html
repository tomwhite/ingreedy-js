<script src="tinytest.js"></script>
<script src="../ingreedy.js"></script>
<script>

  function arrayEq(expected, actual) {
    eq(expected.length, actual.length);
    for (var i = 0; i < expected.length; i++) {
      eq(expected[i], actual[i]);
    }
  }

 tests({

   // tagger.js

      'tokenize': function() {
     arrayEq(["100", "grams", "flour"], tokenize("100 grams flour"));
     arrayEq(["100", "grams", "flour"], tokenize("100g flour"));
     arrayEq(["100", "grams", "flour"], tokenize("100 g flour"));
     arrayEq(["2", "teaspoon", "sugar"], tokenize("2 tsp sugar"));
     arrayEq(["2", "teaspoon", "sugar"], tokenize("2 tsp. sugar"));
     arrayEq(["100", "grams", "big", ",", "green", "apples", "(", "not", "rotten", ")"], tokenize("100 grams big, green apples (not rotten)"));
   },

   'clumpFractions': function() {
     eq("aaa 1$2/3 bbb", clumpFractions("aaa 1 2/3 bbb"));
   },

   'cleanUnicodeFractions': function() {
     eq("1 7/8", cleanUnicodeFractions("1\u215e"));
     eq(" 1/2", cleanUnicodeFractions("\u00bd"));
   },

   'unclump': function() {
     eq("aaa 1 2/3 bbb", unclump("aaa 1$2/3 bbb"));
   },

   'getFeatures': function() {
     var tokens = ["100", "grams", "potatoes"]
     arrayEq(["I2", "L4", "NoCAP", "NoPAREN"], getFeatures("grams", 2, tokens));
   },

   'singularize': function() {
     eq("gram", singularize("grams"));
     eq("nights", singularize("nights"));
   },

   'isCapitalized': function() {
     eq(true, isCapitalized("Apple"));
     eq(false, isCapitalized("apple"));
     eq(false, isCapitalized("aPple"));
   },

   'lengthGroup': function() {
     eq("4", lengthGroup(0));
     eq("4", lengthGroup(1));
     eq("8", lengthGroup(4));
     eq("X", lengthGroup(20));
   },

   'insideParenthesis': function() {
     var tokens = ["100", "grams", "big", ",", "green", "apples", "(", "not", "rotten", ")"]
     eq(true, insideParenthesis("(", tokens));
     eq(true, insideParenthesis(")", tokens));
     eq(true, insideParenthesis("rotten", tokens));
     eq(false, insideParenthesis("green", tokens));
   },

   'smartJoin': function() {
     eq("big, green apples (not rotten)", smartJoin(["big", ",", "green", "apples", "(", "not", "rotten", ")"]));
   },

   'import_data': function() {
     var lines = [
         "# 0.511035",
         "1/2       I1  L12  NoCAP  X  B-QTY/0.982850",
         "teaspoon  I2  L12  NoCAP  X  B-UNIT/0.982200",
         "fresh     I3  L12  NoCAP  X  B-COMMENT/0.716364",
         "thyme     I4  L12  NoCAP  X  B-NAME/0.816803",
         "leaves    I5  L12  NoCAP  X  I-NAME/0.960524",
         ",         I6  L12  NoCAP  X  B-COMMENT/0.772231",
         "finely    I7  L12  NoCAP  X  I-COMMENT/0.825956",
         "chopped   I8  L12  NoCAP  X  I-COMMENT/0.893379",
         "",
         "# 0.505999",
         "Black   I1  L8  YesCAP  X  B-NAME/0.765461",
         "pepper  I2  L8  NoCAP   X  I-NAME/0.756614",
         ",       I3  L8  NoCAP   X  OTHER/0.798040",
         "to      I4  L8  NoCAP   X  B-COMMENT/0.683089",
         "taste   I5  L8  NoCAP   X  I-COMMENT/0.848617"
     ];
     lines = lines.map(line => line.replace(/ +/g, '\t')); // replace spaces with tabs
     var output = import_data(lines);
     eq(2, output.length);

     eq("thyme leaves", output[0]['name']);
     eq("1/2", output[0]['qty']);
     eq("teaspoon", output[0]['unit']);
     eq("fresh, finely chopped", output[0]['comment']);
     eq("<span class='qty'>1/2</span><span class='unit'>teaspoon</span><span class='comment'>fresh</span><span class='name'>thyme leaves</span><span class='comment'>, finely chopped</span>", output[0]['display']);
     eq("1/2 teaspoon fresh thyme leaves, finely chopped", output[0]['input']);

     eq("Black pepper", output[1]['name']);
     eq("to taste", output[1]['comment']);
     eq("<span class='name'>Black pepper</span><span class='other'>,</span><span class='comment'>to taste</span>", output[1]['display']);
    eq("Black pepper, to taste", output[1]['input']);

   },

   'export_data': function() {
     var lines = ["100 grams potatoes", "2 large eggs, freshly laid"]
     eq([`100	I1	L4	NoCAP	NoPAREN
grams	I2	L4	NoCAP	NoPAREN
potatoes	I3	L4	NoCAP	NoPAREN

2	I1	L8	NoCAP	NoPAREN
large	I2	L8	NoCAP	NoPAREN
eggs	I3	L8	NoCAP	NoPAREN
,	I4	L8	NoCAP	NoPAREN
freshly	I5	L8	NoCAP	NoPAREN
laid	I6	L8	NoCAP	NoPAREN
`], export_data(lines));
   },


   // normalization.js

   'tsvToJson': function() {
     var j = tsvToJson(`name\tcalories\tcarbohydrate_content\tfat_content\tfiber_content\tprotein_content
Celeriac, raw\t42\t9.2\t0.3\t1.8\t1.5
Pecans\t691\t14\t72\t9.6\t9.2`);
     eq("Celeriac, raw", j[0].name);
     eq(9.2, j[0].carbohydrate_content);
     eq("Pecans", j[1].name);
     eq(14, j[1].carbohydrate_content);
   },

   'normalize': function() {
     eq("Celeriac, raw", normalize("celeriac"));
   },

   'lookup': function() {
     eq("Celeriac, raw", lookup("celeriac").name);
     eq(9.2, lookup("celeriac").carbohydrate_content);
   },

   // measures.js

   'normalizeQuantity': function() {
     eq(1, normalizeQuantity("1"));
     eq(1.5, normalizeQuantity("1 1/2"));
     eq(5.5, normalizeQuantity("11/2"));
     eq(true, isNaN(normalizeQuantity("1blah")));
   },

   'calculateMass': function() {
     eq(2, calculateMass("2", "gram", "onion"));
     eq(56.6, calculateMass("2", "ounce", "onion"));
     eq(908, calculateMass("2", "pound", "onion"));
     eq(true, isNaN(calculateMass("2", "hundredweight", "onion")));
     eq(350, calculateMass("2", null, "apple"));
     eq(350, calculateMass("2", "", "apple"));
     eq(true, isNaN(calculateMass("2", null, "rabbit")));
     eq(true, isNaN(calculateMass("2", "", "rabbit")));
     eq(true, isNaN(calculateMass("", "", "salt")));
     eq(true, isNaN(calculateMass("2blah", "blah", "onion")));
   },

 });
</script>