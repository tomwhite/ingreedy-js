<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ingreedy demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .imgbox {
            display: grid;
            height: 100%;
        }
        .center-fit {
            max-width: 100%;
            max-height: 100vh;
            margin: auto;
        }
    </style>
</head>
<body>
<input type="file" accept="image/*" id="file-input">
<div class="imgbox">
    <img class="center-fit" id="output">
</div>
<script>

  const fileInput = document.getElementById('file-input');
  fileInput.addEventListener('change', (e) => compress(e));

  function compress(e) {
    var MAX_WIDTH = 1024;
    var MAX_HEIGHT = 768;
    const fileName = e.target.files[0].name;
    const reader = new FileReader();
    reader.readAsDataURL(e.target.files[0]);
    reader.onload = event => {
        const img = new Image();
        img.src = event.target.result;

        img.onload = () => {
                var width = img.width;
                var height = img.height;

                if (width > height) {
                   if (width > MAX_WIDTH) {
                      height *= MAX_WIDTH / width;
                      width = MAX_WIDTH;
                   }
                } else {
                   if (height > MAX_HEIGHT) {
                      width *= MAX_HEIGHT / height;
                      height = MAX_HEIGHT;
                   }
                }

                const elem = document.createElement('canvas');
                elem.width = width;
                elem.height = height;
                const ctx = elem.getContext('2d');
                // img.width and img.height will contain the original dimensions
                ctx.drawImage(img, 0, 0, width, height);
                ctx.canvas.toBlob((blob) => {
                    const file = new File([blob], fileName, {
                        type: 'image/png',
                        lastModified: Date.now()
                    });
                }, 'image/png', 1);
                document.getElementById('output').src = elem.toDataURL('image/png');
                console.log(document.getElementById('output').src);
            },
            reader.onerror = error => console.log(error);
    };
}
</script>
</body>
</html>